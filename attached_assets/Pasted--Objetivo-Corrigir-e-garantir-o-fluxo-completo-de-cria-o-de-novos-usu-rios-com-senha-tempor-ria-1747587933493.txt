
> Objetivo: Corrigir e garantir o fluxo completo de cria√ß√£o de novos usu√°rios com senha tempor√°ria + obrigatoriedade de redefini√ß√£o no primeiro login.

---

### üß© Fluxo esperado:

1. **Cria√ß√£o do usu√°rio:**

   * O sistema cria o usu√°rio no Firebase Authentication com e-mail e senha tempor√°ria.
   * O mesmo UID √© salvo no Firestore na cole√ß√£o `usuarios` (ou `clientes`), com os dados:

     ```json
     {
       uid: "gerado",
       nome: "Jo√£o",
       email: "joao@empresa.com",
       role: "usuario",
       precisa_redefinir_senha: true
     }
     ```
   * Um e-mail de convite √© enviado via Resend, contendo as credenciais (e-mail + senha tempor√°ria + link de login).

2. **Primeiro login:**

   * O usu√°rio insere o e-mail e a senha tempor√°ria no login.
   * O login **deve funcionar normalmente com Firebase Auth.**
   * Ap√≥s o login, o sistema deve buscar no Firestore se:

     ```ts
     usuario.precisa_redefinir_senha === true
     ```
   * Se sim, redirecionar para a p√°gina de "Redefinir Senha".

3. **Redefini√ß√£o de senha:**

   * O usu√°rio cria uma nova senha.
   * O sistema atualiza a senha no Firebase Auth com:

     ```ts
     updatePassword(newPassword)
     ```
   * Ap√≥s atualizar com sucesso:

     * Atualiza no Firestore: `precisa_redefinir_senha: false`
     * Redireciona para o dashboard

---

### ‚úÖ Requisitos e valida√ß√µes

* O login com senha tempor√°ria **precisa funcionar no Firebase Auth**
* Deve haver tratamento para quando o usu√°rio insere a senha errada (mensagem de erro clara)
* O campo `precisa_redefinir_senha` precisa ser verificado **ap√≥s login bem-sucedido**
* A senha nova deve ser atualizada com `updatePassword` (ap√≥s reautentica√ß√£o se necess√°rio)
* O redirecionamento precisa ser controlado com base nesse campo
* Ap√≥s o primeiro login, usu√°rios com `precisa_redefinir_senha: false` entram normalmente

---

### üîç Poss√≠vel causa do problema atual:

* O login n√£o est√° funcionando porque:

  * A senha tempor√°ria n√£o est√° sendo aceita (erro de cria√ß√£o ou envio incorreto)
  * O campo `precisa_redefinir_senha` n√£o est√° sendo verificado corretamente ap√≥s login
  * O login com Firebase Auth n√£o est√° sendo conclu√≠do com sucesso (sem token v√°lido)
  * O frontend est√° tentando redirecionar antes de o Firestore responder

---

### ‚úÖ A√ß√µes esperadas:

* Verificar se a senha gerada est√° sendo realmente salva corretamente no Firebase Auth
* Validar o login com a senha tempor√°ria
* Garantir que o sistema consulta o Firestore ap√≥s login para verificar `precisa_redefinir_senha`
* Redirecionar corretamente baseado nesse campo
* Permitir redefinir a senha e atualizar tanto no Firebase Auth quanto no Firestore
 